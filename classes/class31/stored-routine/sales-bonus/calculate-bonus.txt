 CREATE FUNCTION smart_calculate_bonus
(emp_id CHAR(8)) RETURNS DECIMAL(10,2)
COMMENT 'Calculate employee bonus'
BEGIN
 DECLARE total DECIMAL(10,2);
 DECLARE bonus DECIMAL(10,2);
 SELECT SUM(revenue) INTO total FROM sales WHERE empid = emp_id;
 IF total >= 50000 THEN
 SET bonus = total * .15;
ELSEIF total >= 20000 THEN
 SET bonus = total * .10;
else  set bonus = total * 0.05;
END IF;
  RETURN bonus;
END;
//


select calculate_bonus('101');

select sum(bonus) , calculate_bonus('101') where employee_id = '101';

select sum(`revenue`) , calculate_bonus(employee_id) from sales where employee_id = '101';

select sum(`revenue`), calculate_bonus(employee_id) from sales where employee_id = '101';
select employee_id, sum(`revenue`),smart_calculate_bonus(employee_id) from sales where 1 group by employee_id;
select employee_id, sum(`revenue`) as total_sales,smart_calculate_bonus(employee_id) as bonus from sales where 1 group by employee_id;


SELECT empid,sum(`revenue`) FROM `sales` WHERE 1 group by `empid`;